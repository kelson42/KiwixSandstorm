<html>
<title>File Uploader</title>

<head>
<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.fileupload.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.fileupload-ui.css') }}">

<script src="{{ url_for('static', filename='js/jquery-3.2.0.min.js') }}") }}></script>
<script src="{{ url_for('static', filename='js/vendor/jquery.ui.widget.js') }}") }}></script>
<script src="{{ url_for('static', filename='js/tmpl.min.js') }}") }}></script>
<script src="{{ url_for('static', filename='js/jquery.iframe-transport.js') }}") }}></script>
<script src="{{ url_for('static', filename='js/jquery.fileupload.js') }}") }}></script>
<script src="{{ url_for('static', filename='js/jquery.fileupload-process.js') }}") }}></script>
<script src="{{ url_for('static', filename='js/jquery.fileupload-validate.js') }}") }}></script>
<script src="{{ url_for('static', filename='js/jquery.fileupload-ui.js') }}") }}></script>
<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}") }}></script>
<script src="{{ url_for('static', filename='js/main.js') }}") }}></script>
<!--[if (gte IE 8)&(lt IE 10)]>
<script src="js/cors/jquery.xdr-transport.js"></script>
<![endif]-->
</head>

<body>
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <br><br><br>
            <center>
                <img src="{{ url_for('static', filename='img/kiwix-logo.svg') }}" width=800 height=174>
            <center>
            <br><br><br>
        </div>
    </div>
    {% if read_only and not zim_file_exists %}
        <div>
            <h2>Oops</h2>
            <p>This grain doesn't have content yet, and you don't have permission to upload any.</p>
        <div>
    {% elif not zim_file_exists %}
        <div id="slide-intro">
            <h2>Host wikipedia on a local server. Just a few clicks to set up.</h2>

            <h3>Who is this for?</h3>

            <p>Are you setting up an IT system for your school with limited Internet access? Are you setting up an independent mesh networking community? Are you just a data hoarder? Then you probably would love to have your own local copy of Wikipedia.</p>

            <p>Now, with Kiwix, you can easily set up your own copy of Wikipedia, Wikiquote, Wikivoyage, and many other open content sources with the ease that comes with Sandstorm.</p>
            <h3>Who is this not for?</h3>

            <p>Kiwix is a project independent of this Sandstorm app. Sandstorm makes Kiwix easy to set up, however there are still some limitations to the Sandstorm version. These limitations will hopefully be fixed in future versions, but if they are important to you now, you may choose the standard <a href="http://wiki.kiwix.org/wiki/Features#Web_server" target="_blank" rel="noopener noreferrer">Kiwix web server</a>:</p>

            <ul>
                <li>Searching by document title should work, however searching by document content usually will not.</li>
                <li>External links must manually be opened in new tabs</li>
                <li>Opening internal links in new tabs may feel awkward for users</li>
            </ul>
            <p>Also note that if you are running on somebody else's server (including Sandstorm Oasis) your storage quota may prohibit you from setting up some of the larger content (including Wikipedia)</p>

            <h3>So how does it work?</h3>
            <ul>
                <li>Get a content file from Kiwix's website (or somewhere else)</li>
                <li>Upload it here, into this Sandstorm grain</li>
                <li>Enjoy the content, and share it with others on your local network!</li>
            </ul>

            <a href="#" class="to-slide-download btn btn-primary">Let's get a content file!</a>
            <a href="#" class="to-slide-upload btn btn-info">I already have a content file</a>
            <br>
            <br>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Learn More</h3>
                </div>
                <div class="panel-body">
                    <p>Learn more about the <a href="http://kiwix.org" target="_blank" rel="noopener noreferrer">Kiwix</a> project. There are also apps available for desktop and mobile.</p>
                </div>
            </div>
            <br>
            <br>
            <br>
        </div>
        <div id="slide-download" class="hidden">
            <h2>Download content file</h2>

            <p>Download one content file from the Kiwix website. (If you want multiple content files, make separate grains for each one). The file name will have a ".zim" extension. </p>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Note:</h3>
                </div>
                <div class="panel-body">
                    <ul>
                        <li>Be mindful of your Sandstorm quota. If you're running this on Sandstorm Oasis, you probably don't want to upload a gigabytes large content file.</li>
                        <li>Get a torrent file if you can help it. It'll help save bandwidth for Kiwix, and will probably be faster for you.</li>
                    </ul>
                </div>
            </div>

            <h3>Choose from:</h3>
            <ul class="list-group">
                <a href="http://www.kiwix.org/downloads/" target="_blank" rel="noopener noreferrer"><li class="list-group-item"><strong>Popular content</strong> (Scroll down to "Content only". Don't get the Kiwix software for this!)</li></a>
                <a href="http://wiki.kiwix.org/wiki/Content" target="_blank" rel="noopener noreferrer"><li class="list-group-item"><strong>All English content</strong></li></a>
                <a href="http://wiki.kiwix.org/wiki/Content_in_all_languages" target="_blank" rel="noopener noreferrer"><li class="list-group-item"><strong>All content in all languages</strong></li></a>
            </ul>

            <a href="#" class="to-slide-upload btn btn-primary">Okay, I got my content file.</a>
            <br>
            <br>
            <br>
        </div>
        <div id="slide-upload" class="hidden">
            <h2>Upload content file</h2>

            <p>Now, let's get your content file onto this grain. (Tip: you can even drag and drop the file on some browsers)</p>
            <form id="fileupload" action="/" method="POST" enctype="multipart/form-data">
                <table role="presentation" class="table"><tbody class="files"></tbody></table>
                <div class="row fileupload-buttonbar">
                    <div class="col-lg-12" id="slide-upload-buttons">
                        <span class="btn btn-success fileinput-button">
                            <i class="glyphicon glyphicon-plus"></i>
                            <span>Upload your content file (.zim)</span>
                            <input type="file" name="file">
                        </span>
                        <a href="#" class="to-slide-download btn btn-primary">Oops, go back to download</a>
                    </div>
                </div>
            </form>
            <br>
            <br>
            <br>
        </div>
        <div id="slide-done" class="hidden">
            <div class="row" id="kiwix-waiting">
                <div class="col-lg-12">
                    <center><img src="{{ url_for('static', filename='img/loading.gif') }}"></center>
                </div>
            </div>
            <div class="row hidden" id="kiwix-link">
                <div class="col-lg-12">
                    <a class="btn btn-primary btn-lg" href="/kiwix/">Done! Check it out.</a>
                </div>
            </div>
            <br>
            <br>
            <br>
        </div>
    {% else %}
        <div class="row" id="kiwix-waiting">
            <div class="col-lg-12">
                <center><img src="{{ url_for('static', filename='img/loading.gif') }}"></center>
            </div>
        </div>
        {# Signal to js to redirect as soon as Kiwix is ready #}
        <div id="kiwix-do-redirect"></div>
    {% endif %}

</div>


{% if not zim_file_exists %}
    <footer class="footer">
        <div class="container">
            <p class="text-muted">
                Uploading interface uses Twitter's <a href="http://getbootstrap.com/" target="_blank" rel="noopener noreferrer">Bootstrap</a> CSS framework (including Icons from <a href="http://glyphicons.com/" target="_blank" rel="noopener noreferrer">Glyphicons</a>).
            </p>
        </div>
    </footer>

    {% raw %}
    <script id="template-upload" type="text/x-tmpl">
        <div class="row template-upload fade">
            <div class="col-sm-9">
                <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="progress-bar progress-bar-success" style="width:0%;"></div>
                </div>
            </div>
            <div class="col-sm-3">
                <button class="btn btn-warning cancel">
                    <i class="glyphicon glyphicon-ban-circle"></i>
                    <span>Cancel</span>
                </button>
            </div>
        </div>
    </script>
    <script id="template-download" type="text/x-tmpl">
    {% { %}
        <tr class="template-download fade">
            <td>
                {% if (o.files[0].error) { %}
                    <div><span class="label label-danger">Error</span> {%=o.files[0].error%}</div>
                {% } %}
            </td>
        </tr>
    {% } %}
    </script>
    {% endraw %}
{% endif %}

</body>
</html>
